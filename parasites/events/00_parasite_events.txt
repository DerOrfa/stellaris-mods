namespace = parasite

# initialize parasite event chain on mars (aka the only terraforming candidate  in sol)
country_event = {
	id = parasite.1
	hide_window = yes
	fire_only_once = yes 
	is_triggered_only = yes
	
	immediate = {
		random_system_within_border = {
			limit = { has_star_flag = sol_system }
			random_system_planet = {
				limit = {
					OR = {
						has_modifier = terraforming_candidate
						has_planet_flag = martiancolony # compatibility with mod "colony on mars"
					}
				} 
				save_event_target_as = parasite_planet
				FROMFROM = { country_event = { id = parasite.2 days = 3 random = 1 } }
			}	
		}
		
	}
}

# parasite temple discovered creates temple and special project
country_event = {
	id = parasite.2
	is_triggered_only = yes
	fire_only_once = yes 

	title = "parasite.2.name"
	desc = "parasite.2.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = event_target:parasite_planet

	option = {
		name = EXCELLENT
		hidden_effect = { 
			event_target:parasite_planet = {
				set_planet_flag = parasite_temple
			}
		}
		enable_special_project = {
			name = "PARASITE_TEMPLE_INVESTIGATE"
			location = event_target:parasite_planet
			owner = this
		}

	}
	option = {
		name = parasite.2.b
	}
}

# entered temple
ship_event = {
	id = parasite.5
	is_triggered_only = yes
	fire_only_once = yes 
	
	title = "parasite.5.name"
	desc = "parasite.5.desc"
	picture = GFX_evt_big_landing_ship
	show_sound = event_alien_nature
	location = this

	option = {
		name = EXCELLENT
		leader = { 
			add_experience = 500
			add_trait = leader_trait_expertise_statecraft 
			add_trait = trait_ruler_charismatic
			set_leader_flag = parasite_leader
		}
		event_target:parasite_planet = {
			add_deposit = ancient_lotus_temple_station
		}
	}
}

# planet has been terraformed 
# From = Terraforming country
planet_event = {
	id = parasite.50
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_planet_flag = parasite_temple
	}
	immediate = {
		add_deposit = ancient_lotus_temple
	}
}

##################################
#Events for parasite procreation #
##################################

#when a new pop is born maybe kill a host on that planet
planet_event = {
	id = parasite.101
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		FROMFROM = { pop_has_trait = trait_parasite }
	}

	immediate = {
		random_pop = { 
			limit = { has_job = parasite_host }   
			random_list = {
				50 = {# chances of survival
						modifier = {
							factor = 0.8
							is_enslaved = yes
						}
						modifier = {
							factor = 0.5
							has_citizenship_type = { type = citizenship_purge }
							has_purge_type = { type = purge_labor_camps }
						}
						modifier = {
							factor = 1.2
							or = {
								pop_has_trait = trait_strong 
								pop_has_trait = trait_enduring 
							}
						}
						modifier = {
							factor = 1.3 
							or = {
								pop_has_trait = trait_very_strong 
								pop_has_trait = trait_resilient 
								pop_has_trait = trait_robust 
							}
						}
						modifier = {
							factor = 0.75
							pop_has_trait = trait_weak 
						}
					}
				50 = { kill_pop = yes }
			}
		}
	}
}


# triggered every day
planet_event = {# add host job
	id = parasite.110
	hide_window = yes
	
	trigger = {
		any_pop = { pop_has_trait = trait_parasite } 
		NOT = { has_modifier = planet_parasite_procreation }
	}

	immediate = {
		add_modifier = { modifier = planet_parasite_procreation days = -1 }
	}
}

planet_event = {# remove host job
	id = parasite.111
	hide_window = yes
	
	trigger = {
		has_modifier = planet_parasite_procreation 
		NOT = { any_pop = { pop_has_trait = trait_parasite } }
	}

	immediate = {
		remove_modifier = planet_parasite_procreation 
	}
}

planet_event = { # add no-host malus if there is no host
	id = parasite.112
	hide_window = yes
	
	trigger = {
		has_modifier = planet_parasite_procreation 
		NOT = { has_modifier = planet_parasite_no_host } 
		NOT = { any_pop = { has_job = parasite_host } }
	}

	immediate = {
		add_modifier = { modifier = planet_parasite_no_host days = -1 }
	}
}

planet_event = { # remove no-host malus if there is a host
	id = parasite.113
	hide_window = yes
	
	trigger = {
		has_modifier = planet_parasite_procreation 
		has_modifier = planet_parasite_no_host
		any_pop = { has_job = parasite_host }
	}

	immediate = {
		remove_modifier = planet_parasite_no_host
	}
}
